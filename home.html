<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - HEAD FACE</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
    <body class="bg-gradient-to-br from-blue-100 to-blue-300 min-h-screen flex items-center justify-center">
  <body class="bg-gradient-to-br from-blue-100 to-blue-300 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-md py-4 px-6 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-700">HEAD FACE</h1>
      <button
        id="logout-btn"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-1 rounded-xl font-semibold"
      >
        ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏≠‡∏≤‡∏ó‡πå
      </button>
    </div>
  <body class="bg-gradient-to-br from-blue-100 to-blue-300 min-h-screen flex items-center justify-center">

    <!-- ‡∏Å‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
    <div class="bg-white rounded-2xl shadow-2xl p-6 max-w-xl w-full">
      <div class="text-xl text-blue-800 font-semibold min-h-[3rem]" id="typing-text"></div>
    </div>

    <script>
      const messages = [
        "üéì ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ! ‡∏£‡∏∞‡∏ö‡∏ö HEAD FACE ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô",
        "‚è∞ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°! ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà",
        "üí° ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö LINE ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå"
      ];

      let msgIndex = 0;
      let charIndex = 0;
      const typingElement = document.getElementById("typing-text");

      function typeMessage() {
        const currentMessage = messages[msgIndex];
        if (charIndex < currentMessage.length) {
          typingElement.textContent += currentMessage[charIndex];
          charIndex++;
          setTimeout(typeMessage, 40); // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå
        } else {
          // ‡∏û‡∏±‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡πâ‡∏™‡∏±‡∏Å‡∏û‡∏±‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
          setTimeout(() => {
            typingElement.textContent = "";
            charIndex = 0;
            msgIndex = (msgIndex + 1) % messages.length; // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            typeMessage();
          }, 2000); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 2 ‡∏ß‡∏¥
        }
      }

      typeMessage();
    </script>
  <body class="bg-gradient-to-br from-blue-100 to-blue-300 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-md py-4 px-6 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-700">HEAD FACE</h1>
      <button
        id="logout-btn"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-1 rounded-xl font-semibold"
      >
        ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏≠‡∏≤‡∏ó‡πå
      </button>
    </div>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto mt-8 px-4">
      <div class="bg-white rounded-2xl shadow-xl p-6">
        <h2 class="text-xl font-bold text-blue-700 mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
        <div id="user-info" class="mb-6 text-gray-700"></div>

        <h2 class="text-xl font-bold text-blue-700 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</h2>
        <div id="hw-list" class="space-y-4"></div>
      </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center hidden z-50">
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 border-solid"></div>
    </div>

    <script>
      const user = JSON.parse(localStorage.getItem("user"));
      const loading = document.getElementById("loading");

      if (!user) {
        window.location.href = "index.html";
      } else {
        document.getElementById("user-info").innerHTML = `
          <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${user.firstName} ${user.lastName}</p>
          <p><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</strong> ${user.no}</p>
          <p><strong>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß:</strong> ${user.studentId}</p>
        `;

        checkLastUpdatedAndLoad();
      }

      async function checkLastUpdatedAndLoad() {
        loading.classList.remove("hidden");

        try {
          const res = await fetch("https://script.google.com/macros/s/AKfycbxQyMf_zMNuZoa_JLqa2S5LJYgxd1HwDfnMw-3_FtMH-mN2Db72O4xfqpU17zg2mebPkw/exec?action=lastUpdated");
          const data = await res.json();

          const serverUpdated = data.last_updated;
          const localUpdated = localStorage.getItem("last_updated");
          const localHW = localStorage.getItem("hw_data");

          if (localUpdated === serverUpdated && localHW) {
            renderHomework(JSON.parse(localHW));
          } else {
            await fetchHomework(serverUpdated);
          }
        } catch (err) {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï");
        } finally {
          loading.classList.add("hidden");
        }
      }

      async function fetchHomework(serverUpdated) {
        const url = `https://script.google.com/macros/s/AKfycbxQyMf_zMNuZoa_JLqa2S5LJYgxd1HwDfnMw-3_FtMH-mN2Db72O4xfqpU17zg2mebPkw/exec?action=hw&no=${user.no}`;
        const res = await fetch(url);
        const data = await res.json();

        if (data.status === "success") {
          localStorage.setItem("hw_data", JSON.stringify(data.homework));
          localStorage.setItem("last_updated", serverUpdated);
          renderHomework(data.homework);
        } else {
          alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        }
      }

      function renderHomework(homeworks) {
  const list = document.getElementById("hw-list");
  if (homeworks.length === 0) {
    list.innerHTML = "<p class='text-gray-500'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</p>";
  } else {
    list.innerHTML = homeworks
      .map(
        (hw) => {
          const isSubmitted = hw.submitted || (hw.submitted_no || "").includes(user.no.toString());
          return `
            <div class="border border-gray-300 rounded-xl p-4">
              <h3 class="text-lg font-semibold text-blue-700">${hw.subject}</h3>
              <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: </strong>${hw.title}</p>
              <p><strong>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á: </strong> ${hw.due_date}</p>
              <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: </strong> 
                <span class="${isSubmitted ? "text-green-600" : "text-red-500"}">
                  ${isSubmitted ? "‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" : "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á"}
                </span>
              </p>
              ${
                isSubmitted
                  ? ""
                  : `<button
                      onclick="markAsSubmitted('${hw.id}')"
                      class="mt-2 bg-green-500 hover:bg-green-600 text-white py-1 px-3 rounded-lg"
                    >
                      ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
                    </button>`
              }
            </div>
          `;
        }
      )
      .join("");
  }
}

     async function markAsSubmitted(hwId) {
  const confirmSubmit = confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß?");
  if (!confirmSubmit) return;


  try {
    const url = `https://script.google.com/macros/s/AKfycbxQyMf_zMNuZoa_JLqa2S5LJYgxd1HwDfnMw-3_FtMH-mN2Db72O4xfqpU17zg2mebPkw/exec?action=submit&no=${user.no}&hw_id=${hwId}`
    const res = await fetch(url);
    const data = await res.json();

    if (data.status === "success") {
      alert("‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï localStorage (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
      const hwList = JSON.parse(localStorage.getItem("hw_data"));
      const updatedList = hwList.map(hw => {
        if (hw.id === hwId) {
          hw.submitted = true; // ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Å‡∏à‡∏≤‡∏Å field ‡∏ô‡∏µ‡πâ
        }
        return hw;
      });
      localStorage.setItem("hw_data", JSON.stringify(updatedList));

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
      renderHomework(updatedList);
    } else {
      alert("‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    }
  } catch (err) {
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô");
  }
}
document.addEventListener("DOMContentLoaded", () => {
  const logoutBtn = document.getElementById("logout-btn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", () => {
      localStorage.clear(); // ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ user
      window.location.href = "index.html"; // ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
    });
  }
});

    </script>
     <a href='http://www.freevisitorcounters.com'>www.Freevisitorcounters</a> <script type='text/javascript' src='https://www.freevisitorcounters.com/auth.php?id=0c410dfcdd15ce30d800ce11733435bf89386a35'></script>
<script type="text/javascript" src="https://www.freevisitorcounters.com/en/home/counter/1351601/t/1"></script>
  </body>
</html>
