<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å - HEAD FACE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script data-goatcounter="https://naku23.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>

  </head>
  <body class="bg-gradient-to-br from-blue-100 to-blue-300 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-md py-4 px-6 flex justify-between items-center">
      <button id="menu-btn" class="p-2 text-gray-700 focus:outline-none fixed top-4 left-4 z-50">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <!-- Sidebar -->
      <div id="sidebar" class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg transform -translate-x-full transition-transform duration-300 z-40">
        <div class="p-4 border-b flex justify-between items-center">
          <span class="font-bold text-xl">‡πÄ‡∏°‡∏ô‡∏π</span>
          <button id="close-btn" class="text-gray-500">
            ‚úï
          </button>
        </div>
        <nav class="p-4 space-y-3">
          <a href="index.html" class="block text-blue-600 hover:underline">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
          <a href="login.html" class="block text-blue-600 hover:underline">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà</a>
          <a href="setting.html" class="block text-blue-600 hover:underline">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</a>
        </nav>
      </div>

      <!-- Overlay (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π) -->
      <div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden z-30"></div>
      <h1 class="text-2xl font-bold text-blue-700" style="padding-left: 30px; padding-top: 5px;">HEAD FACE 1.1</h1>
      <button
        id="logout-btn"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-1 rounded-xl font-semibold"
      >
        ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏≠‡∏≤‡∏ó‡πå
      </button>
    </div>
<!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô -->
<div class="max-w-4xl mx-auto mt-4 px-4">
  <div class="bg-white rounded-2xl shadow-lg p-4 text-blue-800 font-semibold text-lg min-h-[60px]">
    <div id="typewriter"></div>
  </div>
</div>

<script>
  const messages = [
    "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏™‡∏π‡πâ ‡πÜ ‡∏ô‡∏∞!",
    "‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏∞!",
    "‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πá‡∏û‡∏±‡∏Å ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏∞",
    "‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ü‡∏£‡∏µ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!",
    "‡∏ñ‡πâ‡∏≤‡∏ä‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞ üòÑ",
    "‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏´‡∏°? ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!",
    "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ HEAD FACE ‚ù§Ô∏è",
    "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô!",
    "‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏´‡∏°‡∏ô‡∏∞? ‡∏Å‡∏î‡∏î‡∏π‡πÄ‡∏•‡∏¢!",
    "‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡∏ß‡πà‡∏≤...‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏π‡∏ç‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‚ú®"
  ];

  let currentMessage = 0;
  let charIndex = 0;
  const typeTarget = document.getElementById("typewriter");

  function typeWriter() {
    const message = messages[currentMessage];
    if (charIndex < message.length) {
      typeTarget.innerHTML += message.charAt(charIndex);
      charIndex++;
      setTimeout(typeWriter, 50); // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå
    } else {
      setTimeout(() => {
        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏ä‡πâ‡∏≤ ‡πÜ
        deleteMessage();
      }, 2500); // ‡∏û‡∏±‡∏Å 2.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏•‡∏ö
    }
  }

  function deleteMessage() {
    const message = messages[currentMessage];
    if (charIndex > 0) {
      typeTarget.innerHTML = message.substring(0, charIndex - 1);
      charIndex--;
      setTimeout(deleteMessage, 30); // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏•‡∏ö
    } else {
      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
      currentMessage = (currentMessage + 1) % messages.length;
      setTimeout(typeWriter, 300);
    }
  }

  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
  document.addEventListener("DOMContentLoaded", () => {
    typeWriter();
  });
</script>


    <!-- Main Content -->
    <div class="max-w-4xl mx-auto mt-8 px-4">
      <div class="bg-white rounded-2xl shadow-xl p-6">
        <h2 class="text-xl font-bold text-blue-700 mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
        <div id="user-info" class="mb-6 text-gray-700"></div>

        <h2 class="text-xl font-bold text-blue-700 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</h2>
        <p id="last-updated-time" class="text-sm text-gray-500 mb-3"></p>
        <!-- ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô -->
        <div class="max-w-4xl mx-auto mt-6 px-4">
          <div class="bg-white rounded-2xl shadow-xl p-4">
            <div class="flex justify-between items-center mb-4">
              <button id="prevMonth" class="text-blue-600 font-bold text-xl">&lt;</button>
              <h2 id="monthYear" class="text-xl font-semibold text-blue-800"></h2>
              <button id="nextMonth" class="text-blue-600 font-bold text-xl">&gt;</button>
            </div>
            <div class="grid grid-cols-7 text-center font-semibold text-blue-700 mb-2">
              <div>‡∏≠‡∏≤.</div><div>‡∏à.</div><div>‡∏≠.</div><div>‡∏û.</div><div>‡∏û‡∏§.</div><div>‡∏®.</div><div>‡∏™.</div>
            </div>
            <div id="calendar" class="grid grid-cols-7 gap-2 text-center text-sm"></div>
          </div>
        </div>

              <div class="mb-4 grid grid-cols-1 md:grid-cols-4 gap-4" style="padding-top: 20px;">
          <select id="filter-status" class="p-2 border rounded">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="submitted">‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</option>
            <option value="not_submitted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á</option>
          </select>

          <input type="date" id="filter-date" class="p-2 border rounded" />

          <input type="text" id="filter-subject" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤" class="p-2 border rounded" />

          <button onclick="applyFilter()" class="bg-blue-500 text-white px-4 py-2 rounded">
            ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          </button>
        </div>
        <div id="hw-list" class="space-y-4"></div>
      </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center hidden z-50">
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 border-solid"></div>
    </div>

    <script>
      const user = JSON.parse(localStorage.getItem("user"));
      const loading = document.getElementById("loading");

      if (!user) {
        window.location.href = "index.html";
      } else {
        document.getElementById("user-info").innerHTML = `
          <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${user.firstName} ${user.lastName}</p>
          <p><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</strong> ${user.no}</p>
          <p><strong>‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß:</strong> ${user.studentId}</p>
        `;

        checkLastUpdatedAndLoad();
      }

      async function checkLastUpdatedAndLoad() {
        loading.classList.remove("hidden");

        try {
          const res = await fetch("https://script.google.com/macros/s/AKfycbxQyMf_zMNuZoa_JLqa2S5LJYgxd1HwDfnMw-3_FtMH-mN2Db72O4xfqpU17zg2mebPkw/exec?action=lastUpdated");
          const data = await res.json();

          const serverUpdated = parseInt(data.last_updated);
          const localUpdated = parseInt(localStorage.getItem("last_updated"));
          const localHW = localStorage.getItem("hw_data");

          if (localUpdated === serverUpdated) {
            renderHomework(JSON.parse(localHW));
            showLastUpdatedTime(serverUpdated);
            console.log(localUpdated)
            console.log(serverUpdated)
          } else {
            await fetchHomework(serverUpdated);
          }
        } catch (err) {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï");
        } finally {
          loading.classList.add("hidden");
        }
      }

      async function fetchHomework(serverUpdated) {
        const url = `https://script.google.com/macros/s/AKfycbxQyMf_zMNuZoa_JLqa2S5LJYgxd1HwDfnMw-3_FtMH-mN2Db72O4xfqpU17zg2mebPkw/exec?action=hw&no=${user.no}`;
        const res = await fetch(url);
        const data = await res.json();

        if (data.status === "success") {
          localStorage.setItem("hw_data", JSON.stringify(data.homework));
          localStorage.setItem("last_updated", serverUpdated);
          renderHomework(data.homework);
          showLastUpdatedTime(serverUpdated);
        } else {
          alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        }
      }

function renderHomework(homeworks, allHomeworks = null) {
  const list = document.getElementById("hw-list");

  if (homeworks.length === 0) {
    list.innerHTML = "<p class='text-gray-500'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</p>";
    return;
  }
  const baseHW = allHomeworks || homeworks;
  // Progress bar
  const total = baseHW.length;
  const submitted = baseHW.filter(hw =>
    hw.submitted || (hw.submitted_no || "").includes(user.no.toString())
  ).length;
  const percent = Math.round((submitted / total) * 100);

  let html = `
    <div class="mb-6">
      <p class="text-sm font-semibold text-gray-600 mb-1">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ${percent}%</p>
      <div class="w-full bg-gray-300 rounded-full h-4 overflow-hidden">
        <div class="bg-blue-500 h-full transition-all duration-500" style="width: ${percent}%"></div>
      </div>
    </div>
  `;

  // ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏¥‡πâ‡∏ô
  const today = new Date();
  homeworks.forEach(hw => {
    const isSubmitted = hw.submitted || (hw.submitted_no || "").includes(user.no.toString());

    const dueDate = new Date(hw.due_date); // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö "yyyy-mm-dd" ‡∏´‡∏£‡∏∑‡∏≠ Date ‡∏ó‡∏µ‡πà parse ‡πÑ‡∏î‡πâ
    const timeDiff = dueDate - today;
    const daysLeft = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

    // ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á
    let boxColor = "bg-white";
    if (!isSubmitted && daysLeft <= 2 && daysLeft >= 0) {
      boxColor = "bg-yellow-100"; // ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô
    }

    html += `
      <div class="${boxColor} border border-gray-300 rounded-xl p-4">
        <h3 class="text-lg font-semibold text-blue-700">${hw.subject}</h3>
        <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${hw.title}</p>
        <p><strong>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á:</strong> ${hw.due_date}</p>
        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong>
          <span class="${isSubmitted ? "text-green-600" : "text-red-500"}">
            ${isSubmitted ? "‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" : "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡πà‡∏á"}
          </span>
        </p>
        ${
          isSubmitted
            ? ""
            : `<button
                onclick="markAsSubmitted('${hw.id}')"
                class="mt-2 bg-green-500 hover:bg-green-600 text-white py-1 px-3 rounded-lg"
              >
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
              </button>`
        }
      </div>
    `;
  });

  list.innerHTML = html;
}

     async function markAsSubmitted(hwId) {
  const confirmSubmit = confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß?");
  if (!confirmSubmit) return;


  try {
    const url = `https://script.google.com/macros/s/AKfycbxQyMf_zMNuZoa_JLqa2S5LJYgxd1HwDfnMw-3_FtMH-mN2Db72O4xfqpU17zg2mebPkw/exec?action=submit&no=${user.no}&hw_id=${hwId}`
    const res = await fetch(url);
    const data = await res.json();

    if (data.status === "success") {
      alert("‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï localStorage (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
      const hwList = JSON.parse(localStorage.getItem("hw_data"));
      const updatedList = hwList.map(hw => {
        if (hw.id === hwId) {
          hw.submitted = true; // ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Å‡∏à‡∏≤‡∏Å field ‡∏ô‡∏µ‡πâ
        }
        return hw;
      });
      localStorage.setItem("hw_data", JSON.stringify(updatedList));

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
      renderHomework(updatedList);
    } else {
      alert("‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    }
  } catch (err) {
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô");
  }
}
document.addEventListener("DOMContentLoaded", () => {
  const logoutBtn = document.getElementById("logout-btn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", () => {
      localStorage.clear(); // ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ user
      window.location.href = "index.html"; // ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
    });
  }
});
      // ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
      let today = new Date();
      function toDateStringLocal(date) {
  const tzOffset = date.getTimezoneOffset() * 60000; // ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ç‡∏ï UTC (‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÄ‡∏õ‡πá‡∏ô ms)
  const localISO = new Date(date - tzOffset).toISOString(); // ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô local ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á
  return localISO.split("T")[0]; // ‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å
}
      let currentMonth = today.getMonth();
      let currentYear = today.getFullYear();

      function renderCalendarWithHomework(homeworks) {
        const calendarEl = document.getElementById("calendar");
        const monthYearEl = document.getElementById("monthYear");

        calendarEl.innerHTML = "";

        const monthNames = [
          "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
          "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
        ];

        monthYearEl.textContent = `${monthNames[currentMonth]} ${currentYear + 543}`;

        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const lastDate = new Date(currentYear, currentMonth + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
          calendarEl.appendChild(document.createElement("div"));
        }

        for (let date = 1; date <= lastDate; date++) {
          const cell = document.createElement("div");
          const thisDate = new Date(currentYear, currentMonth, date);
          const isToday =
          date === today.getDate() &&
          currentMonth === today.getMonth() &&
          currentYear === today.getFullYear();
          const dateStr = toDateStringLocal(thisDate);

          const dailyHW = homeworks.filter(hw => hw.due_date === dateStr);

          cell.className = `rounded-lg p-1 h-20 transition cursor-pointer flex flex-col items-center justify-start overflow-hidden hover:bg-blue-200 ${
            isToday ? "bg-blue-500 text-white font-bold" : "bg-gray-100 text-black"
          }`;
          cell.innerHTML = `<div class='font-bold text-sm'>${date}</div>`;

          dailyHW.forEach(hw => {
            const subj = document.createElement("div");
            subj.className = isToday ? "text-xs truncate w-full" : "text-xs text-blue-700 truncate w-full";
            subj.textContent = hw.subject;
            cell.appendChild(subj);
          });

          cell.addEventListener("click", () => {
            if (dailyHW.length > 0) {
              alert("‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà " + date + ":\n" + dailyHW.map(hw => `${hw.subject}: ${hw.title}`).join("\n"));
            }
          });

          calendarEl.appendChild(cell);
        }
      }

      function updateCalendar() {
        const hwData = JSON.parse(localStorage.getItem("hw_data")) || [];
        renderCalendarWithHomework(hwData);
      }

      document.getElementById("prevMonth").addEventListener("click", () => {
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        updateCalendar();
      });

      document.getElementById("nextMonth").addEventListener("click", () => {
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        updateCalendar();
      });

      document.addEventListener("DOMContentLoaded", () => {
        updateCalendar();
      });

      function showLastUpdatedTime(timestamp) {
  const date = new Date(parseInt(timestamp));
  const options = {
    year: "numeric",
    month: "short",
    day: "numeric",
    hour: "2-digit",
    minute: "2-digit",
    hour12: false
  };

  const formatter = new Intl.DateTimeFormat("th-TH", options);
  const formatted = formatter.format(date).replace(",", "");

  document.getElementById("last-updated-time").textContent =
    "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: " + formatted + " ‡∏ô.";
}

function applyFilter() {
  const statusFilter = document.getElementById("filter-status").value;
  const dateFilter = document.getElementById("filter-date").value;
  const subjectFilter = document.getElementById("filter-subject").value.trim().toLowerCase();

  const allHW = JSON.parse(localStorage.getItem("hw_data")) || [];

  const filtered = allHW.filter(hw => {
    const isSubmitted = hw.submitted || (hw.submitted_no || "").includes(user.no.toString());

    if (statusFilter === "submitted" && !isSubmitted) return false;
    if (statusFilter === "not_submitted" && isSubmitted) return false;
    if (dateFilter && hw.due_date !== dateFilter) return false;
    if (subjectFilter && !hw.subject.toLowerCase().includes(subjectFilter)) return false;

    return true;
  });

  renderHomework(filtered, allHW); // ‚úÖ ‡∏™‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á filtered ‡πÅ‡∏•‡∏∞ all
}

      const menuBtn = document.getElementById("menu-btn");
      const closeBtn = document.getElementById("close-btn");
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");

      menuBtn.addEventListener("click", () => {
        sidebar.classList.remove("-translate-x-full");
        overlay.classList.remove("hidden");
        menuBtn.classList.add("hidden"); // üîπ ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° ‚ò∞
      });

      const closeSidebar = () => {
        sidebar.classList.add("-translate-x-full");
        overlay.classList.add("hidden");
        menuBtn.classList.remove("hidden"); // üîπ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° ‚ò∞
      };

      closeBtn.addEventListener("click", closeSidebar);
      overlay.addEventListener("click", closeSidebar);
    </script>
     <a href='http://www.freevisitorcounters.com'>www.Freevisitorcounters</a> <script type='text/javascript' src='https://www.freevisitorcounters.com/auth.php?id=0c410dfcdd15ce30d800ce11733435bf89386a35'></script>
<script type="text/javascript" src="https://www.freevisitorcounters.com/en/home/counter/1351601/t/1"></script>
  </body>
</html>
